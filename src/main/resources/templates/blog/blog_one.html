<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${blog.title}">Title</title>
    <link href="/css/page.css" rel="stylesheet">
    <link href="/css/blog/blogOne.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/wangEditor/10.0.13/wangEditor.js"></script>
    <link href="https://cdn.bootcss.com/wangEditor/10.0.13/wangEditor.css" rel="stylesheet">
</head>
<body>
<div id="home">
    <div id="header">
        <div id="blogTitle">

            <div class="title"><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle"
                                  th:href="@{'/blog/goBlogListPage.do?id='+${blog.author}}"
                                  th:text="${blog.authorName}">zxCoder</a>
            </div>
            <div class="subtitle">
                愿上层楼骋远目，勿在浮沙筑高台
            </div>

        </div>
        <div id="navigator">

            <ul id="navList">
                <li id="nav_sitehome">
                </li>
                <li id="nav_myhome">
                    <a id="blog_nav_myhome" class="menu" href="/goFrontHomePage.do">
                        首页</a>
                </li>
                <li id="nav_newpost">

                    <a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
                        新随笔</a>
                </li>
                <li id="nav_contact">
                </li>
                <li id="nav_rss">
                </li>
                <li id="nav_admin">
                    <a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
                        管理</a>
                </li>
            </ul>

            <div class="blogStats">

<span id="stats_post_count" th:text="'博客数-'+${totalNum}">随笔 -
97&nbsp;</span>
                <!--                <span id="stats_article_count">文章 - -->
                <!--0&nbsp;</span>-->
                <!-- <span id="stats-comment_count"></span> -->
                <span id="stats_comment_count" th:text="'评论-'+${blog.commentNum}">评论 -
3</span>
            </div>
        </div>
    </div>
    <div id="main">
        <div id="mainContent">
            <div class="forFlow">
                <div id="post_detail">
                    <div id="topics">
                        <div class="post">
                            <h1 class="postTitle">

                                <a id="cb_post_title_url" class="postTitle2"
                                   href="https://www.cnblogs.com/zxcoder/p/12287410.html" th:text="${blog.title}">树/森林和二叉树的转换</a>

                            </h1>
                            <div class="clear"></div>
                            <div class="postBody">

                                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown"
                                     th:utext="${blog.content}">
                                </div>
                                <div id="MySignature"></div>
                                <div class="clear"></div>
                                <div id="blog_post_info_block">

                                    <div id="blog_post_info">
                                        <div id="green_channel">
                                            <a style="display: none" href="javascript:void(0);" id="green_channel_digg">好文要顶</a>
                                            <a style="display: none" href="javascript:void(0);" id="green_channel_digged">已点赞</a>
                                            <a style="display: none" id="green_channel_follow" href="javascript:void(0);">关注我</a>
                                            <a style="display: none" id="green_channel_followed" href="javascript:void(0);">已关注</a>
                                            <a style="display: none" id="green_channel_favorite" href="javascript:void(0);">收藏该文</a>
                                            <a style="display: none" id="green_channel_favorited" href="javascript:void(0);">已收藏</a>
<!--                                            <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博"-->
<!--                                               onclick="ShareToTsina()"><img-->
<!--                                                    src="https://common.cnblogs.com/images/icon_weibo_24.png"-->
<!--                                                    alt=""></a>-->
<!--                                            <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信"-->
<!--                                               onclick="shareOnWechat()"><img-->
<!--                                                    src="https://common.cnblogs.com/images/wechat.png" alt=""></a>-->
                                        </div>
                                    </div>
                                    <div class="clear"></div>
                                </div>
                            </div>
                            <div class="postDesc">posted @
                                <span id="post-date" th:text="${#dates.format(blog.createTime, 'yyyy-MM-dd hh:mm:ss')}">2020-02-09 15:58</span>&nbsp;
                                <a href="https://www.cnblogs.com/zxcoder/" th:text="${blog.authorName}">Keane1998</a>&nbsp;
                                阅读(<span id="post_view_count" th:text="${blog.viewNum}">21</span>)&nbsp;
                                评论(<span id="post_comment_count" th:text="${blog.commentNum}">0</span>)&nbsp;
                                <a href="https://i.cnblogs.com/EditPosts.aspx?postid=12287410" rel="nofollow">编辑</a>&nbsp;
                                <a href="javascript:void(0)" onclick="AddToWz(12287410);return false;">收藏</a></div>
                        </div>
                        <a name="!comments"></a>
                        <div id="blog-comments-placeholder">
                            <div id="comment_pager_top">

                            </div>
                            <div class="feedback_area_title">评论列表</div>
                            <div class="feedbackNoItems"></div>
                            <div class="commentList" th:fragment="comment_list">
                                <span id="commentTotalNum" style="display: none" th:text="${commentTotalNum}"></span>
                                <div class="feedbackItem" th:each="comment,commentStat:${comments}">
                                    <div class="feedbackListSubtitle">
                                        <div class="feedbackManage">
                                            &nbsp;&nbsp;
                                            <span class="comment_actions">
                                                <a href="javascript:void(0);">
                                                    回复
                                                </a>
                                                <a href="javascript:void(0);">
                                                    引用
                                                </a>
                                            </span>
                                        </div>
                                        <!-- Title -->
                                        <a href="#4491338" class="layer" th:text="'#'+${commentStat.index+1}+'楼'">#1楼</a>
                                        <a name="4491338" id="comment_anchor_4491338"></a>
                                        <span id="comment-maxId" style="display:none">4491338</span>
                                        <span id="comment-maxDate" style="display:none">2020/1/30 下午5:59:21</span>
                                        <!-- PostDate -->
                                        <span class="comment_date" th:text="${#dates.format(comment.createTime, 'yyyy-MM-dd hh:mm:ss')}">2020-01-30 17:59</span>
                                        <!--NameLink-->
                                        <a id="a_comment_author_4491338" th:href="@{'/blog/goBlogListPage.do?id='+${comment.sender}}"
                                           target="_blank" th:text="${comment.senderName}">HotSpot-Researcher</a>
                                        <div class="feedbackCon">
                                            <div id="comment_body_4491338" class="blog_comment_body" th:utext="${comment.content}">
                                                我刚出版了一本《深入解析Java编译器：源码剖析与实例详解》，在书中语法糖去除章节详细介绍了内部类的实现机制，希望大家能共同研究，有兴趣留下微信或加我微信mazhimazh
                                            </div>
                                            <div class="comment_vote">
                                                <span class="comment_error" style="color: red"></span>
                                                <a href="javascript:void(0);" class="comment_digg">
                                                    支持(0)
                                                </a>
                                                <a href="javascript:void(0);" class="comment_burry">
                                                    反对(0)
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="comment_pager_bottom">
                                <div id="test1" class="pager">

                                </div>
                            </div>
                        </div>
                        <div id="comment_form" class="commentform">
                            <a name="commentform"></a>
                            <div id="divCommentShow"></div>
                            <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);"
                                                                                         onclick="return RefreshCommentList();"
                                                                                         id="lnk_RefreshComments"
                                                                                         runat="server"
                                                                                         clientidmode="Static">刷新评论</a><a
                                    href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
                            <div id="comment_form_container">
<!--                                <script type="text/javascript"-->
<!--                                        src="https://mention.cnblogs.com//bundles/mention.js?id=20160615"></script>-->
                                <div id="commentform_title">发表评论</div>
                                <span id="tip_comment" style="color:Red"></span>
                                <p>
                                    昵称：<input type="text" id="tbCommentAuthor" class="author" disabled="disabled"
                                              size="50" th:value="${loginUser.username}">
                                </p>
                                <br>
                                <div class="commentbox_main">
                                    <!--                                    <div class="commentbox_title">-->
                                    <!--                                        <div class="commentbox_title_left">评论内容：</div>-->
                                    <!--                                        <div class="commentbox_title_right">-->
                                    <!--                                            <img id="ubb_quote" class="comment_icon" src="https://static.cnblogs.com/images/ubb/quote.gif" alt="引用" title="添加引用" onclick="insertUBB('tbCommentBody','quote')">-->
                                    <!--                                            <img id="ubb_bold" class="comment_icon" src="https://static.cnblogs.com/images/ubb/b.png" alt="粗体" title="添加粗体" onclick="insertUBB('tbCommentBody','b')">-->
                                    <!--                                            <img id="ubb_url" class="comment_icon" src="https://static.cnblogs.com/images/ubb/lk.png" alt="链接" title="添加链接" onclick="insertUbbUrl('tbCommentBody')">-->
                                    <!--                                            <img id="ubb_indent" class="comment_icon" src="https://static.cnblogs.com/images/ubb/indent.png" alt="缩进" title="添加首行缩进" onclick="insertIndent('tbCommentBody')">-->
                                    <!--                                            <img id="ubb_code" class="comment_icon" src="https://static.cnblogs.com/images/ubb/InsertCode.gif" alt="代码" title="添加代码" onclick="insertUbbCode()">-->
                                    <!--                                            <img id="ubb_img" class="comment_icon" src="https://static.cnblogs.com/images/ubb/img.gif" alt="图片" title="上传图片" onclick="OpenImageUploadWindow();">-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div style="display:none">-->
                                    <!--                                        <span id="comment_edit_id"></span><span id="span_parentcomment_id"></span>-->
                                    <!--                                        <span id="span_parent_id"></span>-->
                                    <!--                                        <span id="span_comment_replyto"></span>-->
                                    <!--                                        <span id="span_comment_posted"></span>-->
                                    <!--                                    </div>-->
                                    <!--                                    <textarea id="tbCommentBody" class="comment_textarea"></textarea>-->
                                    <div id="commentBox" style="width:600px"></div>
                                </div>
                                <p id="commentbox_opt">
                                    <input id="btn_comment_submit" type="button" class="comment_btn" value="提交评论">
                                    <!--                                    <span id="span_comment_canceledit" style="display:none"><a href="javascript:void(0);" onclick="return CancelCommentEdit()">不改了</a></span>-->
                                    <!--                                    <a href="javascript:void(0);" onclick="return logout();">退出</a>-->
                                    <!--                                    <a id="commentbox_opt_sub" href="javascript:void(0);" title="订阅后有新评论时会邮件通知您" onclick="commentManager.Subscribe()">订阅评论</a>-->
                                </p>
                                <div id="tip_comment2" style="color:Red"></div>
                                <p>[Ctrl+Enter快捷键提交]</p>
                            </div>
                            <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>

                            <div id="HistoryToday" class="c_ad_block"></div>
<!--                            <script type="text/javascript">-->
<!--                                fixPostBody();-->
<!--                                setTimeout(function () {-->
<!--                                    incrementViewCount(cb_entryId);-->
<!--                                }, 50);-->
<!--                                deliverAdT2();-->
<!--                                deliverAdC1();-->
<!--                                deliverAdC2();-->
<!--                                loadNewsAndKb();-->
<!--                                loadBlogSignature();-->
<!--                                LoadPostCategoriesTags(cb_blogId, cb_entryId);-->
<!--                                LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);-->
<!--                                GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);-->
<!--                                loadOptUnderPost();-->
<!--                                GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);-->
<!--                            </script>-->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="sideBar">
            <div id="sideBarMain">

                <div id="sidebar_news" class="newsItem">
                    <h3 class="catListTitle">公告</h3>

                    <div id="blog-news">

                        <div id="profile_block">
                            昵称：
                            <a th:href="@{'/user/goPersonalPage.do?id='+${blog.author}}" th:text="${blog.authorName}">
                                Keane1998
                            </a>
                            <br>
                            园龄：
                            <a href="https://home.cnblogs.com/u/zxcoder/" title="入园时间：2019-07-24">
                                6个月
                            </a>
                            <br>
                            粉丝：
                            <a href="https://home.cnblogs.com/u/zxcoder/followers/">
                                8
                            </a>
                            <br>
                            关注：
                            <a href="https://home.cnblogs.com/u/zxcoder/followees/">
                                1
                            </a>
<!--                            <script>getFollowStatus('199fa240-4742-4d05-1216-08d70e5dea1c');</script>-->
                        </div>
                    </div>
                </div>

                <div id="calendar">
                    <div id="blog-calendar" style="display:none"></div>
                </div>
<!--                <script>loadBlogDefaultCalendar();</script>-->
                <div id="leftcontentcontainer">
                    <!-- begin:SingleColumn -->
                    <div id="blog-sidecolumn">
                        <!-- 搜索 -->
                        <div id="sidebar_search" class="sidebar-block">
                            <div id="sidebar_search" class="mySearch">
                                <h3 class="catListTitle">搜索</h3>
                                <div id="sidebar_search_box">

                                    <div id="widget_my_google" class="div_my_zzk">
                                        <input type="text" name="google_q" id="google_q"
                                               onkeydown="return google_go_enter(event);"
                                               class="input_my_zzk">&nbsp;<input onclick="google_go()" type="button"
                                                                                 value="谷歌搜索" class="btn_my_zzk">
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- 阅读排行榜 -->
                        <div id="sidebar_topviewedposts" class="sidebar-block">

                            <div id="topview_posts_wrap">
                                <h3 class="catListTitle">阅读排行榜</h3>
                                <div id="TopViewPostsBlock">
                                    <ul style="word-break:break-all" id="top_view_list" th:fragment="top_view_list">
                                        <li th:each="blog,blogStat:${topViewList}">
                                            <a th:href="@{'/blog/goPageOneList.do?id='+${blog.id}}" th:text="${blogStat.index+1}+'. '+${blog.title}+'('+${blog.viewNum}+')'">
                                                1. 【笔记】vue+springboot前后端分离实现token登录验证和状态保存的简单实现方案(889)
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- 评论排行榜 -->


                        <!-- 推荐排行榜 -->
                    </div>
<!--                    <script>loadBlogSideColumn();</script>-->
                    <!-- end:  SingleColumn -->
                </div>
            </div>
        </div>
        <div class="clear"></div>
    </div>
    <div class="clear"></div>
    <div id="footer">
        <!--done-->
        Copyright © 2020 Keane1998
        <br><span id="poweredby">Powered by .NET Core 3.1.1 on Linux</span>

    </div>
</div>
<script src="/third/layui/layui.js"></script>
<script src="/third/jquery/jquery-3.4.1.js"></script>
<script th:inline="javascript">

    layui.use(['laypage','layer'], function () {
        var laypage = layui.laypage;
        var $ = layui.$;
        var layer = layui.layer

        var pageSize = 10;

        var commentTotalNum = [[${commentTotalNum}]]


        function renderPage(){
            getCommentList(1);
            setTimeout(function () {
                commentTotalNum = Number($("#commentTotalNum").text());
                if (commentTotalNum) {
                    //执行一个laypage实例
                    laypage.render({
                        elem: 'test1' //注意，这里的 test1 是 ID，不用加 # 号
                        , count: commentTotalNum //数据总数，从服务端得到
                        , limit: pageSize
                        , jump: function (obj, first) {
                            getCommentList(obj.curr);
                        }
                    });
                } else {
                    $("#test1").html("<h3>无评论</h3>")
                }
            },300)
        }


        getTopViewList();
        addViewNum();
        renderLikeFollowFavoriteBar();
        renderPage();


        var E = window.wangEditor
        var editor = new E('#commentBox')
        // 自定义菜单配置
        editor.customConfig.menus = [
            'bold',
            'italic',
            'quote',
            'emoticon',
            'underline'
        ]
        editor.create()

        $('#btn_comment_submit').click(function () {
            var content = editor.txt.html();
            $.ajax({
                url: '/comment/add.do',
                type: 'POST',
                data: {
                    content: content,
                    sender: [[${loginUser.id}]],
                    senderName:[[${loginUser.username}]],
                    receiver: [[${blog.author}]],
                    receiverName:[[${blog.authorName}]],
                    blogId: [[${blog.id}]]
                },
                dataType: "json",
                success: function (result) {
                    alert(result.msg);
                    renderPage();
                }
            });
        });

        function getCommentList(currentPage) {
            $.ajax({
                url: '/comment/getPage.do',
                type: 'POST',
                data: {
                    size: pageSize,
                    current: currentPage,
                    blogId: [[${blog.id}]]
                },
                success: function (result) {
                    $(".commentList").html(result);
                }
            });
        }

        function getTopViewList() {
            $.ajax({
                url: '/blog/getTopViewList.do',
                type: 'POST',
                data: {
                    size: pageSize,
                    current: 1,
                    id:[[${blog.author}]]
                },
                success: function (result) {
                    $("#top_view_list").html(result);
                }
            });
        }

        function renderLikeFollowFavoriteBar(){
            if([[${isLike}]]){
                $("#green_channel_digged").css("display","inline-block")
            }
            else {
                $("#green_channel_digg").css("display","inline-block")
            }
            if([[${isFavorite}]]){
                $("#green_channel_favorited").css("display","inline-block")
            }
            else {
                $("#green_channel_favorite").css("display","inline-block")
            }
            if([[${isFollow}]]){
                $("#green_channel_followed").css("display","inline-block")
            }
            else {
                $("#green_channel_follow").css("display","inline-block")
            }
        }

        function addViewNum() {
            $.ajax({
                url: '/blogView/addBlogView.do',
                type: 'POST',
                data: {
                    userId: [[${loginUser.id}]],
                    blogId: [[${blog.id}]]
                },
                success: function (result) {
                }
            });
        }

        $("#green_channel_digg").click(function () {
            $.ajax({
                url: '/blogLike/addBlogLike.do',
                type: 'POST',
                data: {
                    userId: [[${loginUser.id}]],
                    blogId: [[${blog.id}]]
                },
                dataType:"json",
                success: function (result) {
                    layer.msg(result.msg)
                }
            });
            $(this).css("display","none");
            $("#green_channel_digged").css("display","inline-block")
            
        });

        $("#green_channel_digged").click(function () {
            $.ajax({
                url: '/blogLike/cancelLike.do',
                type: 'POST',
                data: {
                    userId: [[${loginUser.id}]],
                    blogId: [[${blog.id}]]
                },
                dataType:"json",
                success: function (result) {
                    layer.msg(result.msg)
                }
            });
            $(this).css("display","none");
            $("#green_channel_digg").css("display","inline-block")
        });

        $("#green_channel_follow").click(function () {
            $.ajax({
                url: '/follow/follow.do',
                type: 'POST',
                data: {
                    follower: [[${loginUser.id}]],
                    followerName:[[${loginUser.username}]],
                    followerPicUrl:[[${loginUser.picUrl}]],
                    beFollower: [[${blog.author}]],
                    beFollowerName:[[${blog.authorName}]],
                    beFollowerPicUrl:[[${blog.authorPicUrl}]]
                },
                dataType:"json",
                success: function (result) {
                    layer.msg(result.msg)
                }
            });
            $(this).css("display","none");
            $("#green_channel_followed").css("display","inline-block")
        });

        $("#green_channel_followed").click(function () {
            $.ajax({
                url: '/follow/cancelFollow.do',
                type: 'POST',
                data: {
                    follower: [[${loginUser.id}]],
                    followerName:[[${loginUser.username}]],
                    followerPicUrl:[[${loginUser.username}]],
                    beFollower: [[${blog.author}]],
                    beFollowerName:[[${blog.authorName}]],
                    beFollowerPicUrl:[[${loginUser.username}]]
                },
                dataType:"json",
                success: function (result) {
                    layer.msg(result.msg)
                }
            });
            $(this).css("display","none");
            $("#green_channel_follow").css("display","inline-block")
        });

        $("#green_channel_favorite").click(function () {
            $.ajax({
                url: '/favorite/favorite.do',
                type: 'POST',
                data: {
                    userId: [[${loginUser.id}]],
                    blogId: [[${blog.id}]]
                },
                dataType:"json",
                success: function (result) {
                    layer.msg(result.msg)
                }
            });
            $(this).css("display","none");
            $("#green_channel_favorited").css("display","inline-block")
        });

        $("#green_channel_favorited").click(function () {
            $.ajax({
                url: '/favorite/cancelFavorite.do',
                type: 'POST',
                data: {
                    userId: [[${loginUser.id}]],
                    blogId: [[${blog.id}]]
                },
                dataType:"json",
                success: function (result) {
                    layer.msg(result.msg)
                }
            });
            $(this).css("display","none");
            $("#green_channel_favorite").css("display","inline-block")
        });

    });

</script>
</body>
</html>